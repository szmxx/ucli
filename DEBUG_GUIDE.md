# æœ¬åœ°è°ƒè¯•æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ ä½¿ç”¨ VS Code çš„ debugger æ–­ç‚¹åŠŸèƒ½æ¥è°ƒè¯• ucli é¡¹ç›®ã€‚

## å‰ç½®æ¡ä»¶

1. å®‰è£… VS Code
2. ç¡®ä¿é¡¹ç›®ä¾èµ–å·²å®‰è£…ï¼š`pnpm install`
3. å®‰è£… jitiï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰ï¼š`pnpm add -D jiti`

## è°ƒè¯•é…ç½®

é¡¹ç›®å·²é…ç½®äº†å¤šä¸ªè°ƒè¯•é€‰é¡¹ï¼Œå¯ä»¥é€šè¿‡ VS Code çš„è°ƒè¯•é¢æ¿ä½¿ç”¨ï¼š

### 1. Debug ucli CLI (built)
- **ç”¨é€”**ï¼šè°ƒè¯•ä¸» CLI å…¥å£ï¼Œä¸å¸¦ä»»ä½•å‚æ•°
- **å¯åŠ¨æ–¹å¼**ï¼šæŒ‰ F5 æˆ–åœ¨è°ƒè¯•é¢æ¿é€‰æ‹© "Debug ucli CLI (built)"
- **è°ƒè¯•æ–¹å¼**ï¼šè‡ªåŠ¨æ„å»ºåè°ƒè¯•ç¼–è¯‘åçš„ JavaScript æ–‡ä»¶
- **ä¼˜åŠ¿**ï¼šç¨³å®šå¯é ï¼Œä¸ç”Ÿäº§ç¯å¢ƒä¸€è‡´

### 2. Debug ucli create (built)
- **ç”¨é€”**ï¼šè°ƒè¯• create å‘½ä»¤ï¼Œé¢„è®¾å‚æ•°ä¸º `create test-project`
- **å¯åŠ¨æ–¹å¼**ï¼šåœ¨è°ƒè¯•é¢æ¿é€‰æ‹© "Debug ucli create (built)"
- **è°ƒè¯•æ–¹å¼**ï¼šè‡ªåŠ¨æ„å»ºåè°ƒè¯•ç¼–è¯‘åçš„ JavaScript æ–‡ä»¶

### 3. Debug built CLI
- **ç”¨é€”**ï¼šè°ƒè¯•æ„å»ºåçš„ JavaScript æ–‡ä»¶
- **å¯åŠ¨æ–¹å¼**ï¼šåœ¨è°ƒè¯•é¢æ¿é€‰æ‹© "Debug built CLI"
- **æ³¨æ„**ï¼šéœ€è¦å…ˆè¿è¡Œ `pnpm run build`

### 4. Attach to Node Process
- **ç”¨é€”**ï¼šé™„åŠ åˆ°æ­£åœ¨è¿è¡Œçš„ Node.js è¿›ç¨‹
- **å¯åŠ¨æ–¹å¼**ï¼šå…ˆå¯åŠ¨å¸¦ `--inspect` çš„è¿›ç¨‹ï¼Œç„¶åé€‰æ‹©æ­¤é…ç½®

## ä½¿ç”¨æ­¥éª¤

### æ–¹æ³•ä¸€ï¼šVS Code è°ƒè¯•é¢æ¿

1. åœ¨ VS Code ä¸­æ‰“å¼€é¡¹ç›®
2. åœ¨æºç ä¸­è®¾ç½®æ–­ç‚¹ï¼ˆç‚¹å‡»è¡Œå·å·¦ä¾§æˆ–æŒ‰ F9ï¼‰
3. æŒ‰ `Ctrl+Shift+D`ï¼ˆWindows/Linuxï¼‰æˆ– `Cmd+Shift+D`ï¼ˆMacï¼‰æ‰“å¼€è°ƒè¯•é¢æ¿
4. é€‰æ‹©è°ƒè¯•é…ç½®ï¼ˆå¦‚ "Debug ucli CLI"ï¼‰
5. ç‚¹å‡»ç»¿è‰²æ’­æ”¾æŒ‰é’®æˆ–æŒ‰ F5 å¼€å§‹è°ƒè¯•

### æ–¹æ³•äºŒï¼šå¿«æ·é”®è°ƒè¯•

1. åœ¨æºç ä¸­è®¾ç½®æ–­ç‚¹
2. ç›´æ¥æŒ‰ F5 å¯åŠ¨é»˜è®¤è°ƒè¯•é…ç½®
3. ç¨‹åºä¼šåœ¨æ–­ç‚¹å¤„æš‚åœï¼Œä½ å¯ä»¥ï¼š
   - æŸ¥çœ‹å˜é‡å€¼
   - å•æ­¥æ‰§è¡Œï¼ˆF10ï¼‰
   - è¿›å…¥å‡½æ•°ï¼ˆF11ï¼‰
   - è·³å‡ºå‡½æ•°ï¼ˆShift+F11ï¼‰
   - ç»§ç»­æ‰§è¡Œï¼ˆF5ï¼‰

## å¸¸ç”¨è°ƒè¯•åœºæ™¯

### è°ƒè¯• CLI å¯åŠ¨è¿‡ç¨‹

åœ¨ `src/cli.ts` ä¸­è®¾ç½®æ–­ç‚¹ï¼š

```typescript
// åœ¨è¿™é‡Œè®¾ç½®æ–­ç‚¹
function start() {
  debugger; // æˆ–è€…æ·»åŠ  debugger è¯­å¥
  try {
    const main = defineCommand({
      // ...
    });
  }
}
```

### è°ƒè¯•ç¯å¢ƒå˜é‡åŠ è½½

åœ¨ `src/env.ts` ä¸­è®¾ç½®æ–­ç‚¹ï¼š

```typescript
export function getEnvConfig(): EnvConfig {
  debugger; // åœ¨è¿™é‡Œè®¾ç½®æ–­ç‚¹
  return {
    NODE_ENV: process.env.NODE_ENV || 'development',
    // ...
  };
}
```

### è°ƒè¯•å‘½ä»¤æ‰§è¡Œ

åœ¨ `src/commands/create.ts` ä¸­è®¾ç½®æ–­ç‚¹ï¼š

```typescript
// åœ¨å‘½ä»¤å¤„ç†å‡½æ•°ä¸­è®¾ç½®æ–­ç‚¹
export default defineCommand({
  run(ctx) {
    debugger; // åœ¨è¿™é‡Œè®¾ç½®æ–­ç‚¹
    // å‘½ä»¤é€»è¾‘
  }
});
```

## è°ƒè¯•æŠ€å·§

### 1. ä½¿ç”¨ debugger è¯­å¥

åœ¨ä»£ç ä¸­ç›´æ¥æ·»åŠ  `debugger;` è¯­å¥ï¼š

```typescript
function someFunction() {
  const config = getEnvConfig();
  debugger; // ç¨‹åºä¼šåœ¨è¿™é‡Œæš‚åœ
  console.log(config);
}
```

### 2. æ¡ä»¶æ–­ç‚¹

å³é”®ç‚¹å‡»æ–­ç‚¹ï¼Œè®¾ç½®æ¡ä»¶ï¼š

```javascript
// åªæœ‰å½“ env.DEBUG ä¸º true æ—¶æ‰æš‚åœ
env.DEBUG === true
```

### 3. æ—¥å¿—æ–­ç‚¹

å³é”®ç‚¹å‡»æ–­ç‚¹ï¼Œé€‰æ‹© "Edit Breakpoint" > "Logpoint"ï¼š

```javascript
// è¾“å‡ºå˜é‡å€¼è€Œä¸æš‚åœç¨‹åº
"Config loaded: {config}"
```

### 4. è°ƒè¯•æ§åˆ¶å°

åœ¨è°ƒè¯•æ—¶ï¼Œå¯ä»¥åœ¨ "DEBUG CONSOLE" ä¸­æ‰§è¡Œè¡¨è¾¾å¼ï¼š

```javascript
// æŸ¥çœ‹å˜é‡
env
process.env.NODE_ENV

// æ‰§è¡Œå‡½æ•°
getEnvConfig()
```

## ç¯å¢ƒå˜é‡è°ƒè¯•

è°ƒè¯•é…ç½®å·²ç»è®¾ç½®äº†ç¯å¢ƒå˜é‡ï¼š

- `NODE_ENV=debug`ï¼šå¯ç”¨è°ƒè¯•æ¨¡å¼
- è‡ªåŠ¨åŠ è½½ `.env` æ–‡ä»¶

ä½ å¯ä»¥åœ¨ `.env` æ–‡ä»¶ä¸­è®¾ç½®ï¼š

```env
DEBUG=true
NODE_ENV=debug
```

## å¸¸è§é—®é¢˜

### 1. æ–­ç‚¹ä¸ç”Ÿæ•ˆ

- ç¡®ä¿ä½¿ç”¨çš„æ˜¯ TypeScript æºç è°ƒè¯•é…ç½®
- æ£€æŸ¥ source map æ˜¯å¦æ­£ç¡®ç”Ÿæˆ
- å°è¯•é‡å¯è°ƒè¯•ä¼šè¯

### 2. æ— æ³•é™„åŠ åˆ°è¿›ç¨‹

```bash
# å¯åŠ¨å¸¦è°ƒè¯•ç«¯å£çš„è¿›ç¨‹
node --inspect=9229 bin/index.mjs

# ç„¶åä½¿ç”¨ "Attach to Node Process" é…ç½®
```

### 3. ç¯å¢ƒå˜é‡æœªåŠ è½½

- æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- ç¡®ä¿è°ƒè¯•é…ç½®ä¸­çš„ `envFile` è·¯å¾„æ­£ç¡®

## é«˜çº§è°ƒè¯•

### è°ƒè¯•æµ‹è¯•

```bash
# è°ƒè¯•ç‰¹å®šæµ‹è¯•
node --inspect-brk node_modules/.bin/vitest run --no-coverage
```

### æ€§èƒ½è°ƒè¯•

```bash
# ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
node --prof bin/index.mjs create test-project
node --prof-process isolate-*.log > profile.txt
```

## å¿«é€Ÿå¼€å§‹

1. å¤åˆ¶ç¯å¢ƒé…ç½®ï¼š`cp .env.example .env`
2. åœ¨ `src/cli.ts` çš„ `start()` å‡½æ•°å¼€å¤´è®¾ç½®æ–­ç‚¹
3. æŒ‰ F5 å¼€å§‹è°ƒè¯•
4. ç¨‹åºä¼šåœ¨æ–­ç‚¹å¤„æš‚åœï¼Œä½ å¯ä»¥å¼€å§‹è°ƒè¯•äº†ï¼

### å¼€å‘æ¨¡å¼è¿è¡Œ

```bash
# ä½¿ç”¨ pnpm è„šæœ¬è¿è¡Œï¼ˆæ¨èï¼‰
pnpm run dev
pnpm run dev --help
pnpm run dev create test-project

# æˆ–è€…ç›´æ¥ä½¿ç”¨ jiti
npx jiti src/cli.ts
npx jiti src/cli.ts create
```

### å¼€å‘å·¥å…·æ¨è

- **VS Code è°ƒè¯•**ï¼šä½¿ç”¨è°ƒè¯•é¢æ¿ä¸­çš„é…ç½®è¿›è¡Œæ–­ç‚¹è°ƒè¯•
- **å¼€å‘æ¨¡å¼**ï¼šä½¿ç”¨ `pnpm run dev` å¿«é€Ÿè¿è¡Œå’Œæµ‹è¯•
- **æ„å»ºè°ƒè¯•**ï¼šä½¿ç”¨æ„å»ºåçš„æ–‡ä»¶è¿›è¡Œç¨³å®šè°ƒè¯•
- **æ—¥å¿—è°ƒè¯•**ï¼šä½¿ç”¨ `console.log` æˆ– `consola.debug` è¾“å‡ºè°ƒè¯•ä¿¡æ¯
- **æ£€æŸ¥å™¨è°ƒè¯•**ï¼šä½¿ç”¨ `pnpm run debug:inspect` è¿›è¡Œé«˜çº§è°ƒè¯•

ç°åœ¨ä½ å¯ä»¥æ„‰å¿«åœ°ä½¿ç”¨æ–­ç‚¹è°ƒè¯• ucli é¡¹ç›®äº†ï¼ğŸ‰
